---
title: "[AWS] WAF ì„œë¹„ìŠ¤ë¡œ íŠ¹ì • ê²½ë¡œ ì ‘ê·¼ ì œí•œ"
excerpt: ""

categories:
    - Infra

tags:
    - [S3]
    - [CloudFront]
    - [WAF]

permalink: /infra/s3-cf-waf/

toc: true
toc_sticky: true

date: 2023-06-21
last_modified_at: 2023-06-21
---

ìš´ì˜ ì¤‘ì¸ ì„œë¹„ìŠ¤ì—ì„œ ê°œì¸ ì •ë³´ì™€ ê´€ë ¨ëœ íŒŒì¼ì´ë‚˜ ì´ë¯¸ì§€ê°€ ì €ì¥ëœ íŠ¹ì • ê²½ë¡œì— ì ‘ê·¼ ì œí•œì´ ì—†ì—ˆê¸° ë•Œë¬¸ì— AWS WAF ì„œë¹„ìŠ¤ë¥¼ í†µí•´ì„œ ì ‘ê·¼ì„ ì œí•œí•´ ë³´ì•˜ë‹¤.<br>
ë‚´ë¶€ IPì—ì„œëŠ” ì ‘ê·¼ ê°€ëŠ¥, ì™¸ë¶€ IPì—ì„œëŠ” ì ‘ê·¼ ë¶ˆê°€ëŠ¥ìœ¼ë¡œ ì œí•œì„ í–ˆë‹¤.

> S3ì— CloudFrontê°€ ì—°ê²°ë˜ì–´ ìˆëŠ” ìƒíƒœì—ì„œ WAFë¥¼ ì—°ë™í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

* * *

#### Step 1
AWS WAF > IP sets > Create IP set
![ê³¼ì •1](/assets/images/posts/s3-cf-waf/1.png "ê³¼ì •2")
* * *

#### Step 2
ë‚´ë¶€ IP ì„¤ì •
![ê³¼ì •2](/assets/images/posts/s3-cf-waf/2.png "ê³¼ì •2")
* * *

#### Step 3
AWS WAF > Web ACLs > Create web ACL
![ê³¼ì •3](/assets/images/posts/s3-cf-waf/3.png "ê³¼ì •3")
* * *

#### Step 4
web ACL ì´ë¦„ ì„¤ì •
![ê³¼ì •4](/assets/images/posts/s3-cf-waf/4.png "ê³¼ì •4")
* * *

#### Step 5
Rules ì¶”ê°€
![ê³¼ì •5](/assets/images/posts/s3-cf-waf/5.png "ê³¼ì •5")
* * *

#### Step 6
ì²«ë²ˆì§¸ Rule ì´ë¦„ ì„¤ì • (í—ˆìš©í•  IPì™€ íŠ¹ì • ê²½ë¡œ ì„¤ì •ì— ëŒ€í•œ ê·œì¹™)
![ê³¼ì •6](/assets/images/posts/s3-cf-waf/6.png "ê³¼ì •6")
* * *

#### Step 7
íŠ¹ì • ê²½ë¡œ + ì„¤ì •í•œ ë‚´ë¶€ IP ê·œì¹™ì„ ë¬¶ì–´ì„œ í—ˆìš©í•œë‹¤ëŠ” ê·œì¹™ì„ ì„¤ì •<br>
**String to match**ëŠ” íŠ¹ì • ê²½ë¡œë¡œ ì„¤ì • (ex. test/example)
![ê³¼ì •7](/assets/images/posts/s3-cf-waf/7.png "ê³¼ì •7")
* * *

#### Step 8
ë‘ë²ˆì§¸ Rule ì´ë¦„ ì„¤ì • (íŠ¹ì • ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ì„ ì œí•œí•˜ë ¤ëŠ” ê·œì¹™)
![ê³¼ì •8](/assets/images/posts/s3-cf-waf/8.png "ê³¼ì •8")
* * *

#### Step 9
íŠ¹ì • ê²½ë¡œëŠ” ì œí•œí•œë‹¤ëŠ” ê·œì¹™ì„ ì„¤ì •<br>
**String to match**ëŠ” íŠ¹ì • ê²½ë¡œë¡œ ì„¤ì • (ex. test/example)
![ê³¼ì •9](/assets/images/posts/s3-cf-waf/9.png "ê³¼ì •9")
* * *

#### Step 10
ì„¤ì •í•œ Rule ì™¸ì—ëŠ” í—ˆìš©í•œë‹¤ëŠ” ì„¤ì •
![ê³¼ì •10](/assets/images/posts/s3-cf-waf/10.png "ê³¼ì •10")
* * *

#### Step 11
í—ˆìš©í•˜ëŠ” ê·œì¹™ì„ ìš°ì„  ìˆœìœ„ë¡œ ì„¤ì •
![ê³¼ì •11](/assets/images/posts/s3-cf-waf/11.png "ê³¼ì •11")
* * *

#### Step 12
![ê³¼ì •12](/assets/images/posts/s3-cf-waf/12.png "ê³¼ì •12")
* * *

#### Step 13
![ê³¼ì •13](/assets/images/posts/s3-cf-waf/13.png "ê³¼ì •13")
* * *

#### Step 14
ì„¤ì •í•  CloudFrontì— ì„¤ì •ì„ í¸ì§‘í•˜ì—¬ WAFë¥¼ í™œì„±í™” ì‹œí‚¨ í›„ ìƒì„±í•´ë‘ì—ˆë˜ WAFë¥¼ ì„¤ì •
![ê³¼ì •14](/assets/images/posts/s3-cf-waf/14.png "ê³¼ì •14")
* * *

#### Step 15
ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸âœ…<br>
ì™¸ë¶€ IPë¡œ ì ‘ê·¼í•˜ë©´ 403 Error ë°œìƒğŸš«
![í™•ì¸](/assets/images/posts/s3-cf-waf/mobile.jpeg "í™•ì¸")